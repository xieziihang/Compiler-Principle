## 修改

1. 在 Absyn.fs 增加 for 循环的语法规则

![W9Dqy.png](https://s1.328888.xyz/2022/06/02/W9Dqy.png)

2. 在 CLex.fsl 文件中增加 for token

![W9W73.png](https://s1.328888.xyz/2022/06/02/W9W73.png)

3. CPar.fsy 中增加 for token 并且定义相关语法规则

![W90WT.png](https://s1.328888.xyz/2022/06/02/W90WT.png)

![W9YwX.png](https://s1.328888.xyz/2022/06/02/W9YwX.png)

5. 增加解释器相关内容

![](https://s3.bmp.ovh/imgs/2022/06/02/ec9b1557f33cabfd.png)

**编译器**

```F#
    | For(e1, e2, e3, body) -> 
      let labbegin = newLabel()
      let labtest  = newLabel()
      
      cExpr e1 varEnv funEnv
      @ [GOTO labtest; Label labbegin] @ cStmt body varEnv funEnv
      @ cExpr e3 varEnv funEnv
      @ [Label labtest] @ cExpr e2 varEnv funEnv @ [IFNZRO labbegin]
```

### 测试代码

```c
void main() {
  int i;
  for(i = 1; i < 5; i++) {
    print i;
    println;
  }
}
```

**执行结果：**

![](https://s3.bmp.ovh/imgs/2022/06/02/85922efebd446d7a.png)

#### AST：

![](https://s3.bmp.ovh/imgs/2022/06/02/c09be2397e5a07b0.png)

**运行栈**

```
[ ]{0:LDARGS}
[ ]{1:CALL 0 5}
[ 4 -999 ]{5:INCSP 1}
[ 4 -999 12654480 ]{7:GETBP}
[ 4 -999 12654480 2 ]{8:CSTI 0}
[ 4 -999 12654480 2 0 ]{10:ADD}
[ 4 -999 12654480 2 ]{11:CSTI 1}
[ 4 -999 12654480 2 1 ]{13:STI}
[ 4 -999 1 1 ]{14:INCSP -1}
[ 4 -999 1 ]{16:GOTO 45}
[ 4 -999 1 ]{45:GETBP}
[ 4 -999 1 2 ]{46:CSTI 0}
[ 4 -999 1 2 0 ]{48:ADD}
[ 4 -999 1 2 ]{49:LDI}
[ 4 -999 1 1 ]{50:CSTI 5}
[ 4 -999 1 1 5 ]{52:LT}
[ 4 -999 1 1 ]{53:IFNZRO 18}
[ 4 -999 1 ]{18:GETBP}
[ 4 -999 1 2 ]{19:CSTI 0}
[ 4 -999 1 2 0 ]{21:ADD}
[ 4 -999 1 2 ]{22:LDI}
[ 4 -999 1 1 ]{23:PRINTI}
1 [ 4 -999 1 1 ]{24:INCSP -1}
[ 4 -999 1 ]{26:CSTI 10}
[ 4 -999 1 10 ]{28:PRINTC}

[ 4 -999 1 10 ]{29:INCSP -1}
[ 4 -999 1 ]{31:INCSP 0}
[ 4 -999 1 ]{33:GETBP}
[ 4 -999 1 2 ]{34:CSTI 0}
[ 4 -999 1 2 0 ]{36:ADD}
[ 4 -999 1 2 ]{37:DUP}
[ 4 -999 1 2 2 ]{38:LDI}
[ 4 -999 1 2 1 ]{39:CSTI 1}
[ 4 -999 1 2 1 1 ]{41:ADD}
[ 4 -999 1 2 2 ]{42:STI}
[ 4 -999 2 2 ]{43:INCSP -1}
[ 4 -999 2 ]{45:GETBP}
[ 4 -999 2 2 ]{46:CSTI 0}
[ 4 -999 2 2 0 ]{48:ADD}
[ 4 -999 2 2 ]{49:LDI}
[ 4 -999 2 2 ]{50:CSTI 5}
[ 4 -999 2 2 5 ]{52:LT}
[ 4 -999 2 1 ]{53:IFNZRO 18}
[ 4 -999 2 ]{18:GETBP}
[ 4 -999 2 2 ]{19:CSTI 0}
[ 4 -999 2 2 0 ]{21:ADD}
[ 4 -999 2 2 ]{22:LDI}
[ 4 -999 2 2 ]{23:PRINTI}
2 [ 4 -999 2 2 ]{24:INCSP -1}
[ 4 -999 2 ]{26:CSTI 10}
[ 4 -999 2 10 ]{28:PRINTC}

[ 4 -999 2 10 ]{29:INCSP -1}
[ 4 -999 2 ]{31:INCSP 0}
[ 4 -999 2 ]{33:GETBP}
[ 4 -999 2 2 ]{34:CSTI 0}
[ 4 -999 2 2 0 ]{36:ADD}
[ 4 -999 2 2 ]{37:DUP}
[ 4 -999 2 2 2 ]{38:LDI}
[ 4 -999 2 2 2 ]{39:CSTI 1}
[ 4 -999 2 2 2 1 ]{41:ADD}
[ 4 -999 2 2 3 ]{42:STI}
[ 4 -999 3 3 ]{43:INCSP -1}
[ 4 -999 3 ]{45:GETBP}
[ 4 -999 3 2 ]{46:CSTI 0}
[ 4 -999 3 2 0 ]{48:ADD}
[ 4 -999 3 2 ]{49:LDI}
[ 4 -999 3 3 ]{50:CSTI 5}
[ 4 -999 3 3 5 ]{52:LT}
[ 4 -999 3 1 ]{53:IFNZRO 18}
[ 4 -999 3 ]{18:GETBP}
[ 4 -999 3 2 ]{19:CSTI 0}
[ 4 -999 3 2 0 ]{21:ADD}
[ 4 -999 3 2 ]{22:LDI}
[ 4 -999 3 3 ]{23:PRINTI}
3 [ 4 -999 3 3 ]{24:INCSP -1}
[ 4 -999 3 ]{26:CSTI 10}
[ 4 -999 3 10 ]{28:PRINTC}

[ 4 -999 3 10 ]{29:INCSP -1}
[ 4 -999 3 ]{31:INCSP 0}
[ 4 -999 3 ]{33:GETBP}
[ 4 -999 3 2 ]{34:CSTI 0}
[ 4 -999 3 2 0 ]{36:ADD}
[ 4 -999 3 2 ]{37:DUP}
[ 4 -999 3 2 2 ]{38:LDI}
[ 4 -999 3 2 3 ]{39:CSTI 1}
[ 4 -999 3 2 3 1 ]{41:ADD}
[ 4 -999 3 2 4 ]{42:STI}
[ 4 -999 4 4 ]{43:INCSP -1}
[ 4 -999 4 ]{45:GETBP}
[ 4 -999 4 2 ]{46:CSTI 0}
[ 4 -999 4 2 0 ]{48:ADD}
[ 4 -999 4 2 ]{49:LDI}
[ 4 -999 4 4 ]{50:CSTI 5}
[ 4 -999 4 4 5 ]{52:LT}
[ 4 -999 4 1 ]{53:IFNZRO 18}
[ 4 -999 4 ]{18:GETBP}
[ 4 -999 4 2 ]{19:CSTI 0}
[ 4 -999 4 2 0 ]{21:ADD}
[ 4 -999 4 2 ]{22:LDI}
[ 4 -999 4 4 ]{23:PRINTI}
4 [ 4 -999 4 4 ]{24:INCSP -1}
[ 4 -999 4 2 5 ]{42:STI}
[ 4 -999 5 5 ]{43:INCSP -1}
[ 4 -999 5 ]{45:GETBP}
[ 4 -999 5 2 ]{46:CSTI 0}
[ 4 -999 5 2 0 ]{48:ADD}
[ 4 -999 5 2 ]{49:LDI}
[ 4 -999 5 5 ]{50:CSTI 5}
[ 4 -999 5 5 5 ]{52:LT}
[ 4 -999 5 0 ]{53:IFNZRO 18}
[ 4 -999 5 ]{55:INCSP -1}
[ 4 -999 ]{57:RET -1}
[ -999 ]{4:STOP}
```

